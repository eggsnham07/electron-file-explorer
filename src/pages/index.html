<!DOCTYPE html>
<html>
    <head>
        <script id="mainjs"></script>
        <script>
            const os = require("os")
            const fs = require("fs")
            if(fs.existsSync(os.homedir() + "/.electron-file-explorer/main-script.js")) document.getElementById("mainjs").innerHTML = fs.readFileSync(os.homedir() + "/.electron-file-explorer/main-script.js")
        </script>

        <link rel="stylesheet" href="./css/styling.css">
    </head>

    <body style="background-color: rgb(1, 73, 141);">
        <div class="content">
            <div class="nav top">
                <a href="javascript:history.go(-1);" title="Go back"><img class="icon left" src="./assets/bootstrap-icons/arrow-left.svg"></a>
                <span style="color:#33333300;">---</span>
                <a href="javascript:history.go(+1);" title="Go forwards"><img class="icon" style="position:fixed;left:48px;" src="./assets/bootstrap-icons/arrow-right.svg"></a>

                <input id="path" class="top path" type="text">

                <a href="?s=show" id="opt1" title="Open settings"><img class="icon right" src="./assets/bootstrap-icons/gear-wide-connected.svg"></a>
                <a href="javascript:downloadUpdate()" title="Check for updates"><img style="display: none;margin-right: 12px;" id="updateButton" class="icon right" src="./assets/bootstrap-icons/cloud-arrow-down.svg"></a>
            </div>
            <div class="context-menu" id="cm" style="display: none;">
                <a href="javascript:openTerminal()">Open terminal here</a>
            </div>
            <div id="sidePanel">
                <br>
                <a href="javascript:location.href = `?path=${os.homedir()}`">Home</a>
                <br><br>
                <a href="javascript:openHome('Desktop')">Desktop</a>
                <br><br>
                <a href="javascript:openHome('Documents')">Documents</a>
                <br><br>
                <a href="javascript:openHome('Downloads')">Downloads</a>
                <br><br>
                <a href="javascript:openHome('Pictures')">Pictures</a>
                <br><br>
                <a href="javascript:openHome('Videos')">Videos</a>
                <br><br><br><br>
                <a href="javascript:openDrive('')">File System</a>
            </div>
            <br><br><br><br>
            <main id="fe"></main>
        </div>
        <script>
            const GithubContent = require("github-content")

            if(fs.existsSync(os.homedir() + "/.electron-file-explorer/update.txt") == false) {
                downloadUpdate()
                console.log("Update avaliable")
            }

            initPage(os.homedir())

            document.onclick = hideMenu
            document.oncontextmenu = openMenu

            function openMenu(e) {
                e.preventDefault()
                if(document.getElementById("cm").style.display == "block") hideMenu()
                else {
                    var menu = document.getElementById("cm")
                    menu.style.display = "block"
                    menu.style.left = e.pageX + "px"
                    menu.style.top = e.pageY + "px"
                }
            }

            function hideMenu() {
                document.getElementById("cm").style.display = "none"
            }

            if(fs.existsSync(os.homedir() + "/.electron-file-explorer/update.txt") == false) {
                downloadUpdate()
                console.log("Update avaliable")
            }
            else if( Number(fs.readFileSync(os.homedir() + "/.electron-file-explorer/update.txt", "utf-8")) < new Date().getDate()) {
                document.getElementById("updateButton").style.display = "block"
                console.log("Update avaliable")
            } else {
                console.log(Number(fs.readFileSync(os.homedir() + "/.electron-file-explorer/update.txt", "utf-8")))
            }


            function downloadUpdate() {
                if(!fs.existsSync(os.homedir() + "/.electron-file-explorer/")) fs.mkdirSync(os.homedir() + "/.electron-file-explorer/")
                
                const ops = {
                    owner: "eggsnham07",
                    repo: "electron-file-explorer",
                    branch: "main"
                }

                var github = new GithubContent(ops)

                github.file("src/pages/script.js", (err, file) => {
                    if(err) return console.log(err)
                    fs.writeFileSync(os.homedir() + "/.electron-file-explorer/main-script.js", file.contents)
                    fs.writeFileSync(os.homedir() + "/.electron-file-explorer/update.txt", String(new Date().getDate()))

                    console.log(
                        "Updated!",
                        Number(fs.readFileSync(os.homedir() + "/.electron-file-explorer/update.txt", "utf-8"))
                    )

                    window.location.reload()
                })


                /*
                fs.writeFileSync(os.homedir() + "/.electron-file-explorer/update.txt", new Date().getDate())
                console.log(
                    "Updated!",
                    Number(fs.readFileSync(os.homedir() + "/.electron-file-explorer/update.txt", "utf-8")) < new Date().getDate()
                )
                */
            }
        </script>
    </body>
</html>
